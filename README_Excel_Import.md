# 工资Excel数据导入工具

这是一个Python脚本，用于将Excel格式的工资表数据自动导入到SQLite数据库中。

## 功能特点

- 支持中英文列名的Excel文件
- 自动验证员工ID是否存在
- 智能处理年月信息（支持多种格式）
- 自动计算总工资（如果Excel中未提供）
- 支持更新已存在的工资记录
- 详细的错误报告和导入统计
- 支持多种工资字段（基础工资、岗位工资、绩效工资等）

## 安装依赖

在运行脚本之前，请先安装所需的Python包：

```bash
pip install -r requirements.txt
```

或者手动安装：

```bash
pip install pandas openpyxl
```

## Excel文件格式要求

### 必需列（支持中英文列名）

| 中文列名 | 英文列名 | 说明 | 示例 |
|---------|---------|------|------|
| 员工ID/员工工号 | employee_id | 员工唯一标识 | EMP001 |
| 年份 | year | 工资年份 | 2024 |
| 月份 | month | 工资月份 | 3 |
| 基础工资/基本工资 | base_salary | 基本工资金额 | 5000 |

### 可选列

| 中文列名 | 英文列名 | 说明 | 默认值 |
|---------|---------|------|--------|
| 岗位工资/职位工资 | position_salary | 岗位工资 | 0 |
| 绩效工资 | performance_salary | 绩效工资 | 0 |
| 加班费 | overtime_pay | 加班费 | 0 |
| 奖金 | bonus | 奖金 | 0 |
| 津贴 | allowance | 津贴 | 0 |
| 扣除/扣款 | deduction | 扣款 | 0 |
| 合计/总工资 | total_salary | 总工资（自动计算） | 自动计算 |
| 发放日期 | payment_date | 发放日期 | 当月10号 |

### 年月格式支持

脚本支持以下年月格式：

1. **分别的年份和月份列**：
   - 年份列：2024
   - 月份列：3

2. **年月合并列**（列名：年月/year_month）：
   - 2024年3月
   - 2024-03
   - 202403
   - 2024/03

## 使用方法

### 基本用法

```bash
python import_salary_excel.py your_salary_file.xlsx
```

### 指定数据库路径

```bash
python import_salary_excel.py your_salary_file.xlsx --db path/to/your/database.db
```

### 示例

```bash
# 导入工资数据
python import_salary_excel.py 2024年3月工资表.xlsx

# 使用自定义数据库路径
python import_salary_excel.py 2024年3月工资表.xlsx --db server/database/salary.db
```

## Excel文件示例

### 示例1：中文列名

| 员工ID | 年份 | 月份 | 基础工资 | 岗位工资 | 绩效工资 | 加班费 | 奖金 | 津贴 | 扣除 | 发放日期 |
|--------|------|------|----------|----------|----------|--------|------|------|------|----------|
| EMP001 | 2024 | 3 | 5000 | 1000 | 800 | 500 | 1000 | 0 | 100 | 2024-03-10 |
| EMP002 | 2024 | 3 | 6000 | 1200 | 1000 | 0 | 800 | 0 | 50 | 2024-03-10 |

### 示例2：英文列名

| employee_id | year | month | base_salary | position_salary | performance_salary | overtime_pay | bonus | allowance | deduction | payment_date |
|-------------|------|-------|-------------|-----------------|-------------------|--------------|-------|-----------|-----------|-------------|
| EMP001 | 2024 | 3 | 5000 | 1000 | 800 | 500 | 1000 | 0 | 100 | 2024-03-10 |
| EMP002 | 2024 | 3 | 6000 | 1200 | 1000 | 0 | 800 | 0 | 50 | 2024-03-10 |

### 示例3：年月合并格式

| 员工ID | 年月 | 基础工资 | 岗位工资 | 绩效工资 | 加班费 | 奖金 | 津贴 | 扣除 | 合计 |
|--------|------|----------|----------|----------|--------|------|------|------|------|
| EMP001 | 2024年3月 | 5000 | 1000 | 800 | 500 | 1000 | 0 | 100 | 8200 |
| EMP002 | 2024-03 | 6000 | 1200 | 1000 | 0 | 800 | 0 | 50 | 8950 |
| EMP003 | 202403 | 4500 | 800 | 600 | 200 | 500 | 0 | 0 | 6600 |

## 输出说明

脚本运行时会显示详细的处理信息：

```
==================================================
工资Excel数据导入工具
==================================================
成功连接到数据库：server/database/salary.db
找到 10 个员工记录
成功读取Excel文件：2024年3月工资表.xlsx
数据行数：8
列名：['员工ID', '年份', '月份', '基础工资', '岗位工资', '绩效工资']

成功处理 8 条记录
新增员工 EMP001 2024年3月工资记录
更新员工 EMP002 2024年3月工资记录
...

==================================================
导入结果统计
==================================================
成功导入：8 条记录
导入失败：0 条记录

✅ 导入完成！
```

## 错误处理

脚本会自动检测和报告以下错误：

- 员工ID不存在
- 基础工资为空或小于等于0
- 月份不在1-12范围内
- Excel文件格式错误
- 数据库连接失败

## 注意事项

1. **员工ID必须存在**：导入前请确保Excel中的员工ID在数据库的employees表中已存在
2. **基础工资必填**：基础工资不能为空或0
3. **重复记录处理**：如果某员工某月的工资记录已存在，脚本会更新该记录
4. **数据备份**：建议在导入前备份数据库
5. **Excel格式**：支持.xlsx和.xls格式

## 故障排除

### 常见问题

1. **"员工ID不存在"错误**
   - 检查Excel中的员工ID是否与数据库中的employee_id匹配
   - 确保员工ID格式正确（如EMP001而不是EMP1）

2. **"基础工资必须大于0"错误**
   - 检查Excel中基础工资列是否有空值或0值
   - 确保数值格式正确

3. **"数据库文件不存在"错误**
   - 检查数据库文件路径是否正确
   - 确保数据库文件存在且有读写权限

4. **"读取Excel文件失败"错误**
   - 检查Excel文件是否损坏
   - 确保文件未被其他程序占用
   - 检查文件路径是否正确

## 技术支持

如果遇到问题，请检查：
1. Python版本（建议3.7+）
2. 依赖包是否正确安装
3. Excel文件格式是否符合要求
4. 数据库文件是否可访问